<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>iReporter Red Flag</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex,nofollow"/>
    <link rel="icon" type="image/png" href="img/favicon.ico">
    <link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/notifications.css">
    <noscript>
      <h1>Your browser does not support Javascript</h1>
    </noscript>  
    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/moment.min.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <span class="navbar-toggle" id="js-navbar-toggle">
        <i class="fa fa-bars"></i>
      </span>
      <a href="home.html" class="logo">iReporter</a>
      <ul class="main-nav" id="js-menu">
        <li>
          <a href="redflags.html"  class="nav-links">red flags</a>
        </li>
        <li>
          <a href="interventions.html"  class="nav-links">interventions</a>
        </li>
        <li>
          <a href="profile.html" class="nav-links ">profile</a>
        </li>
        <li>
            <button class="logout-button" onclick="logout()"><i class="fa fa-power-off" aria-hidden="true"></i></button>
        </li>        
      </ul>
    </nav>
    <div class="container wrapper">
        <!-- Trigger/Open The Modal -->
        <div class="modal-container-buttons">
            <button id="btnImage" class="button-modal btnOwner" data-modal="modal-window-image-upload" title="Upload Image"><i class="fa fa-picture-o" aria-hidden="true"></i></button>
            <button id="btnVideo" class="button-modal btnOwner" data-modal="modal-window-video-upload" title="Upload Video"><i class="fa fa-video-camera" aria-hidden="true"></i></button>
            <button id="btnGeolocate" class="button-normal btnOwner"  title="Geolocate"><i class="fa fa-map-marker" aria-hidden="true"></i></button>
            <button id="btnEdit" class="button-modal orange btnOwner" data-modal="modal-window-edit" title="Edit Location & Comment"><i class="fa fa-pencil" aria-hidden="true"></i></button> 
            <button id="btnDelete" class="button-modal danger btnOwner" data-modal="modal-window-delete" title="Delete Red Flag"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
            <span  id="modal-admin-buttons"></span>
            <script>
                let adminStatus = isAdmin;
                
                if(adminStatus == 'true'){
                  let result = '';
                  result +=`
                  <button id="btnEditStatus" class="button-modal orange btnOwner" data-modal="modal-window-edit-status" title="Edit Status"><i class="fa fa-pencil" aria-hidden="true"> status</i></button> 
                  <!-- The Modal -->
                  <div id="modal-window-edit-status" class="modal">
            
                      <!-- Modal content -->
                      <div class="modal-content">
                        <span class="close">&times;</span>
                        <div  class="modal-form">
                            <form id="patchStatus" method="POST" >
                              <p><label for="status">Edit Status</label></p>
                              <select name="status" id="status">
                                  <option value="draft">Draft</option>
                                  <option value="resolved">Resolve</option>
                                  <option value="under investigation">Investigate</option>
                                  <option value="rejected">Reject</option>
                              </select>

                              
                              <br>
                              <input name="submit" class="button-normal" tabindex="5" value="Change Status" type="submit">
                              <i id="fa-spin-edit-status" class="fa fa-circle-o-notch fa-spin" ></i>
                          </form>       
                        </div>
                      </div>
                    
                    </div>           
                  `;
                  document.getElementById('modal-admin-buttons').innerHTML = result;
                }
      
              </script>
            <div id="modal-window-delete" class="modal">
                <!--Delete Modal -->
                <div  class="modal-content">
                    <span class="close">&times;</span>
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Delete Red Flag</h5>
                              <span aria-hidden="true" data-modal="modal-window-delete">&times;</span>
                          
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete this red flag?</p>
                            <p id="error-message"></p>
                        </div>
                        <div class="modal-footer">
                          <button id="btnDelConfirm" type="button" class="button-normal danger" >Delete</button>
                          <i id="fa-spin-data-delete" class="fa fa-circle-o-notch fa-spin" ></i>
                        </div>    
                  </div>
              
              </div>
              <div id="modal-window-edit" class="modal">
                <!--Edit Modal -->
                <div  class="modal-content">
                    <span class="close">&times;</span>
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Edit Red Flag</h5>
                              <span aria-hidden="true">&times;</span>
                            
                        </div>
                        <div class="modal-body">
                          <div  class="modal-form">
                            <form id="patchData" method="POST" enctype="multipart/form-data">
                              <p class="contact"><label for="title">Title</label></p>
                              <input id="title" name="title" placeholder="Title" maxlength="100" tabindex="1" type="text">
                              <p class="contact"><label for="comment">Comment</label></p>
                              <textarea name="comment" id="comment" maxlength="1000" cols="30" rows="10"></textarea>          
                              <p class="contact"><label for="date">Location</label></p>
                              <div id="addMarker" style="width:100%;height:400px;"></div>
                              <input id="location" readonly name="location" placeholder="Location" required="" type="text">
                                
                              <br>
                              <input id='submit' name="submit" class="button-normal" tabindex="5" value="Edit Red Flag" type="submit">
                              <i id="fa-spin-edit" class="fa fa-circle-o-notch fa-spin" ></i>
                            </form>
                          </div>
                        </div>   
                  </div>
              
              </div>
              <!--Upload Image Modal -->
              <div id="modal-window-image-upload" class="modal">
                  <div class="modal-content">
                    <span class="close">&times;</span>
                    <div  class="modal-form">
                        <form id="uploadImage" method="POST" enctype="multipart/form-data">
                          <p class="contact"><label for="profilepic">Upload Image</label></p>
                          <input class="black" type="file" id="fileImage" name="uploadFile" accept="image/*" multiple>
                          
                          <br>
                          <input class="button-normal" name="submit" id="submit" tabindex="5" value="Upload" type="submit">
                          <i id="fa-spin-upload" class="fa fa-circle-o-notch fa-spin" ></i>
                          <p id="upload-message"></p>
                      </form>       
                    </div>
                  </div>
              </div>
              <div id="modal-window-video-upload" class="modal">

                  <!--Upload Video Modal -->
                  <div class="modal-content">
                    <span class="close">&times;</span>
                    <div  class="modal-form">
                        <form id="uploadVideo" method="POST" enctype="multipart/form-data">
                          <p class="contact"><label for="profilepic">Upload Video</label></p>
                          <input class="black" type="file" id="name" name="uploadFile" accept="video/*" multiple>
                          
                          <br>
                          <input class="button-normal" name="submit" id="submit" tabindex="5" value="Upload" type="submit">
      
                      </form>       
                    </div>
                  </div>
              </div>          
        </div>
        <div id='incident-data' class="container">
            <h2 class="black" id="message"></h2>
            <center><i id="fa-spin-data" class="fa fa-circle-o-notch fa-spin" ></i></center>
            <script src="js/models_incidents.js"></script>
            <script>
              let urlParams = new URLSearchParams(window.location.search);
              let redflagId = urlParams.get('redflag_id');

              //Method call to get redflag by id
              getDataById('redflags', redflagId);            

              //Method to delete an intervention
              var btnDelConfirm = document.getElementById('btnDelConfirm');
              btnDelConfirm.addEventListener("click", deleteIntervention);
              function deleteIntervention(){
                deleteData('redflags', redflagId);
              }

              //Update a specific Intervention's Location
              document.getElementById('patchData').addEventListener('submit', (event) => editLocation(event, 'redflags', redflagId)); 

              //Update a specific Intervention's Comment
              document.getElementById('patchData').addEventListener('submit', (event) => editComment(event, 'redflags', redflagId));
   
              //Admin Update a specific Intervention's Status
              try {
                document.getElementById('patchStatus').addEventListener('submit', (event) => editStatus(event, 'redflags', redflagId));
              }
              catch(error) {
                
              } 
              
              //Upload an image
              document.getElementById('uploadImage').addEventListener('submit', (event) => uploadImage(event, 'redflags', redflagId));
              

              //Upload an Video
              document.getElementById('uploadVideo').addEventListener('submit', (event) => uploadVideo(event, 'redflags', redflagId));              

            </script>          
        </div>
        <p id="locationArea"></p>
        <p><div id="googleMap" style="width:100%;height:400px;"><span class="black">Click Geolocate button at the top to load map</span></div></p>         
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwWJfWNiu6zGJCAZ0p6sO-IVR9iRj5I-0"></script>
            <script src="js/geolocation.js"></script>
            <script src="js/mapper.js"></script>       
         

        <div class="push"></div>
    </div>
    <div class="footer">
      <ul>
        <li>
          <a href="contact.html"  class="nav-links">contact</a>
        </li>
        <li>
          <a href="about.html"  class="nav-links">about</a>
        </li>    
        <li><a href="#" class="nav-links">privacy & terms</a></li>    
      </ul>
    </div>
    <script src="js/main.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/logout.js"></script>
  </body>
</html>
